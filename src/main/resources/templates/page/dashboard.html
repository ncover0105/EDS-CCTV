<!DOCTYPE html>
<html lang="ko"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <title th:text="${title}">CCTV 보안 시스템 대시보드</title>
    <script src="/js/jsmpeg.min.js"></script>

    <style>
        :root {
        --primary-color: #4e73df;
        --secondary-color: #1cc88a;
        --warning-color: #f6c23e;
        --danger-color: #e74a3b;
        --info-color: #36b9cc;
        --dark-color: #5a5c69;
        --light-color: #f8f9fc;
        --card-border-radius: 0.35rem;
        --transition-speed: 0.3s;
        }

        .dashboard-container {
        padding: 1.5rem;
        }

        .dashboard-header {
        margin-bottom: 1.5rem;
        }

        .dashboard-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 0.5rem;
        }

        .dashboard-subtitle {
        font-size: 1rem;
        color: #e3e6f0;
        }

        .row {
        display: flex;
        flex-wrap: wrap;
        margin-right: -0.75rem;
        margin-left: -0.75rem;
        }

        .col {
        flex: 1;
        padding: 0 0.75rem;
        margin-bottom: 1.5rem;
        min-width: 300px;
        }

        .card {
        background-color: #2e2e48;
        border-radius: var(--card-border-radius);
        box-shadow: 0 0.15rem 1.75rem rgba(0, 0, 0, 0.05);
        margin-bottom: 1.5rem;
        position: relative;
        transition: transform var(--transition-speed);
        }

        .card:hover {
        transform: translateY(-3px);
        }

        .card-header {
        margin-top: 0.3rem;
        padding: 0.75rem 1.25rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.215);
        background-color: #2e2e48;
        color: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-top-left-radius: var(--card-border-radius);
        border-top-right-radius: var(--card-border-radius);
        }

        .status-icon {
            font-size: 2rem;
            color: #4e73df;
        }

        .card-title {
        font-size: 1rem;
        font-weight: 700;
        margin: 0;
        }

        .card-body {
            color: #fff;
            padding: 1.25rem;
        }

        .card-footer {
        padding: 0.75rem 1.25rem;
        color: #fff;
        border-top: 1px solid rgba(0, 0, 0, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom-left-radius: var(--card-border-radius);
        border-bottom-right-radius: var(--card-border-radius);
        }

        /* Status Cards */
        .status-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
        }

        .status-card {
        flex: 1;
        min-width: 220px;
        border-left: 0.25rem solid;
        background-color: #fff;
        box-shadow: 0 0.15rem 1.75rem rgba(0, 0, 0, 0.05);
        border-radius: var(--card-border-radius);
        padding: 1rem;
        transition: transform var(--transition-speed);
        }

        .status-card:hover {
        transform: translateY(-3px);
        }

        .status-card.primary {
        border-left-color: var(--primary-color);
        }

        .status-card.success {
        border-left-color: var(--secondary-color);
        }

        .status-card.warning {
        border-left-color: var(--warning-color);
        }

        .status-card.danger {
        border-left-color: var(--danger-color);
        }

        .status-card-title {
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        color: var(--dark-color);
        margin-bottom: 0.25rem;
        }

        .status-card-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 0;
        }

        .status-card-icon {
        float: right;
        font-size: 1.75rem;
        opacity: 0.3;
        }

        /* CCTV Monitor */
        .cctv-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        .cctv-feed {
            display: flex;
            position: relative;
            border-radius: var(--card-border-radius);
            overflow: hidden; /* 중요: 이미지가 컨테이너를 넘어가지 않도록 함 */
            background-color: #000;
            aspect-ratio: 16/9; /* 이미지 비율 고정 */
            height: auto; /* 높이를 자동으로 조정 */
        }

        .cctv-feed img {
            width: 100%;
            height: 100%; /* 부모 컨테이너의 높이에 맞춤 */
            object-fit: cover; /* 이미지 비율 유지하면서 영역 채우기 */
            object-position: center; /* 이미지 중앙 정렬 */
        }

        .cctv-label {
        position: absolute;
        top: 0.5rem;
        left: 0.5rem;
        background-color: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 0.25rem 0.5rem;
        border-radius: 3px;
        font-size: 0.75rem;
        }

        .cctv-status {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background-color: rgba(28, 200, 138, 0.9);
        color: #fff;
        padding: 0.25rem 0.5rem;
        border-radius: 3px;
        font-size: 0.75rem;
        }

        .cctv-status.offline {
        background-color: rgba(231, 74, 59, 0.9);
        }

        /* Timeline */
        .timeline {
        position: relative;
        margin: 0;
        padding: 0;
        list-style: none;
        color: #000;
        }

        .timeline:before {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        left: 1rem;
        width: 2px;
        background-color: #e3e6f0;
        }

        .timeline-item {
        position: relative;
        padding-left: 3rem;
        padding-bottom: 1.5rem;
        }

        .timeline-item:last-child {
        padding-bottom: 0;
        }

        .timeline-badge {
        position: absolute;
        left: 0;
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        text-align: center;
        line-height: 2rem;
        color: #fff;
        background-color: var(--primary-color);
        }

        .timeline-badge.success {
        background-color: var(--secondary-color);
        }

        .timeline-badge.warning {
        background-color: var(--warning-color);
        }

        .timeline-badge.danger {
        background-color: var(--danger-color);
        }

        .timeline-content {
        padding: 1rem;
        background-color: #fff;
        border-radius: var(--card-border-radius);
        box-shadow: 0 0.15rem 1.75rem rgba(0, 0, 0, 0.05);
        }

        .timeline-title {
        margin: 0;
        font-size: 0.9rem;
        font-weight: 700;
        }

        .timeline-time {
        font-size: 0.75rem;
        color: #858796;
        margin-bottom: 0.5rem;
        }

        .timeline-text {
        margin: 0;
        font-size: 0.85rem;
        color: #666;
        }

        /* Speaker Status */
        .speaker-list {
        list-style: none;
        padding: 0;
        margin: 0;
        }

        .speaker-item {
        display: flex;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid #e3e6f0;
        }

        .speaker-item:last-child {
        border-bottom: none;
        }

        .speaker-icon {
        font-size: 1.25rem;
        width: 2.5rem;
        text-align: center;
        color: var(--primary-color);
        }

        .speaker-info {
        flex: 1;
        }

        .speaker-name {
        margin: 0;
        font-size: 0.9rem;
        font-weight: 600;
        }

        .speaker-location {
        margin: 0;
        font-size: 0.75rem;
        color: #858796;
        }

        .speaker-status {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 3px;
        background-color: #eaecf4;
        color: #858796;
        }

        .speaker-status.active {
        background-color: rgba(28, 200, 138, 0.1);
        color: var(--secondary-color);
        }

        .speaker-status.inactive {
        background-color: rgba(231, 74, 59, 0.1);
        color: var(--danger-color);
        }

        /* Settings Summary */
        .settings-list {
        list-style: none;
        padding: 0;
        margin: 0;
        }

        .settings-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 0;
        border-bottom: 1px solid #e3e6f0;
        }

        .settings-item:last-child {
        border-bottom: none;
        }

        .settings-item-title {
        margin: 0;
        font-size: 0.9rem;
        font-weight: 600;
        }

        .settings-item-description {
        margin: 0;
        font-size: 0.75rem;
        color: #858796;
        }

        .settings-value {
        font-size: 0.85rem;
        color: var(--info-color);
        }

        /* Progress bar */
        .progress {
        height: 0.5rem;
        border-radius: 0.25rem;
        margin-top: 0.5rem;
        background-color: #eaecf4;
        }

        .progress-bar {
        height: 100%;
        border-radius: 0.25rem;
        background-color: var(--primary-color);
        }

        .progress-bar.success {
        background-color: var(--secondary-color);
        }

        .progress-bar.warning {
        background-color: var(--warning-color);
        }

        .progress-bar.danger {
        background-color: var(--danger-color);
        }

        /* Buttons */
        .btn {
        display: inline-block;
        padding: 0.375rem 0.75rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
        font-weight: 500;
        text-align: center;
        text-decoration: none;
        cursor: pointer;
        transition: all var(--transition-speed);
        border: 1px solid transparent;
        }

        .btn-primary {
        background-color: var(--primary-color);
        color: #fff;
        }

        .btn-primary:hover {
        background-color: #2653d4;
        }

        .btn-success {
        background-color: var(--secondary-color);
        color: #fff;
        }

        .btn-success:hover {
        background-color: #17a673;
        }

        .btn-warning {
        background-color: var(--warning-color);
        color: #fff;
        }

        .btn-warning:hover {
        background-color: #f4b619;
        }

        .btn-danger {
        background-color: var(--danger-color);
        color: #fff;
        }

        .btn-danger:hover {
        background-color: #e02d1b;
        }

        .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        }

        /* Media Queries */
        @media (max-width: 992px) {
        .col {
            min-width: 250px;
        }
        }

        @media (max-width: 768px) {
        .status-card {
            min-width: 170px;
        }
        }

        @media (max-width: 576px) {
        .dashboard-container {
            padding: 1rem;
        }

        .status-card {
            min-width: 100%;
        }

        .timeline:before {
            left: 0.75rem;
        }

        .timeline-item {
            padding-left: 2.5rem;
        }
        }
    </style>
</head>
<body>
    <div class="container-fluid p-3" layout:fragment="content">
        <div class="p-4">
            <div class="mb-4">
                <h3>안전관리 시스템 대시보드</h3>
            </div>
        
            <!-- 상태 카드 -->
            <div class="row">
                <div class="col-md-7 d-flex flex-column">
                    <div class="card h-100 d-flex flex-column">
                        <div class="card-header py-2 px-3 bg-transparent">
                            <h2 class="card-title">상태 요약</h2>
                        </div>
                        <div class="card-body flex-grow-1 d-flex flex-wrap p-3">
                            <div class="row g-3 d-flex flex-grow-1 p-2">
                                <div class="col-md-6">
                                    <div class="d-flex flex-grow-1 justify-content-between align-items-center rounded-2 p-3 h-100 bg-gradient-warning">
                                        <div>
                                            <div class="card-title mb-1 fs-4">CCTV 상태</div>
                                            <div class="fw-bold fs-5">정상 4 / 10</div>
                                        </div>
                                        <i class="fas fa-video fs-2"></i>
                                    </div>
                                </div>
                    
                                <div class="col-md-6">
                                    <div class="d-flex flex-grow-1 justify-content-between align-items-center rounded-2 p-3 h-100 bg-gradient-warning">
                                        <div>
                                            <div class="card-title mb-1 fs-4">스피커 상태</div>
                                            <div class="fw-bold fs-5">정상 4 / 10</div>
                                        </div>
                                        <i class="fas fa-volume-up fs-2"></i>
                                    </div>
                                </div>
                    
                                <div class="col-md-6">
                                    <div class="d-flex flex-grow-1 justify-content-between align-items-center rounded-2 p-3 h-100 bg-gradient-warning">
                                        <div>
                                            <div class="card-title mb-1 fs-4">출입 알림</div>
                                            <div class="fw-bold fs-5">486 개</div>
                                        </div>
                                        <i class="fas fa-exclamation-triangle fs-2"></i>
                                    </div>
                                </div>
                    
                                <div class="col-md-6">
                                    <div class="d-flex flex-grow-1 justify-content-between align-items-center rounded-2 p-3 h-100 bg-gradient-warning">
                                        <div>
                                            <div class="card-title fs-4 mb-1">발령 기록</div>
                                            <div class="fw-bold fs-5">5 개</div>
                                        </div>
                                        <i class="fas fa-podcast fs-2"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-5 d-flex flex-column">
                    <div class="card d-flex h-100">
                        <div class="card-header py-2 px-3">
                            <h2 class="card-title text-nowrap">빠른 발령</h2>
                            <!-- <a href="#" class="btn btn-primary btn-sm">설정 변경</a> -->
                            <div class="d-flex gap-2 align-items-center">
                                <small class="text-nowrap">스피커</small>
                                <select class="form-select form-select-sm gap-2" name="speakerType">
                                    <option value="">전체</option>
                                    <option value="1">스피커1</option>
                                    <option value="2">스피커2</option>
                                    <option value="3">스피커3</option>
                                    <option value="4">스피커4</option>
                                </select>
                                <small class="text-nowrap">알림</small>
                                <select class="form-select form-select-sm gap-2" name="sendType" style="min-width: 130px; padding-left: 12px; padding-right: 12px;">
                                    <option value="wav1">태풍경보</option>
                                    <option value="wav2">홍수주의보</option>
                                    <option value="wav3">산불경보</option>
                                    <option value="wav4">대설경보</option>
                                </select>
                                <a href="#" id="sendAlertBtn" class="d-flex text-nowrap btn btn-primary btn-sm">발령</a>
                            </div>
                        </div>
                        <div class="card-body">
                            <ul class="settings-list">
                                <li class="settings-item">
                                    <div>
                                        <h3 class="settings-item-title">태풍경보</h3>
                                        <p class="settings-item-description">오늘 12시 대구지역 태풍경보 발령. 실내에 머무르세요. 해안가, 급경사지 등 위험 지역에는 가지 마시고, 대피권고를 받으면 즉시 대피하세요.</p>
                                    </div>
                                    <span class="settings-value text-nowrap p-1">활성화</span>
                                </li>
                                <li class="settings-item">
                                    <div>
                                        <h3 class="settings-item-title">홍수주의보</h3>
                                        <p class="settings-item-description">오늘 12시 대구시 홍수주의보 발령. 방송 등에서 홍수 상황을 확인하시고, 저지대 침수와 하천 범람에 주의하세요.</p>
                                    </div>
                                    <span class="settings-value text-nowrap p-1">활성화</span>
                                </li>
                                <li class="settings-item">
                                    <div>
                                        <h3 class="settings-item-title">산불 발생</h3>
                                        <p class="settings-item-description">오늘 12시 30분 대구시 남구 앞산 산불 발생. 입산 금지. 인근 주민과 등산객은 안전사고에 주의하세요.</p>
                                    </div>
                                    <span class="settings-value text-nowrap p-1">활성화</span>
                                </li>
                                <li class="settings-item">
                                    <div>
                                        <h3 class="settings-item-title">대설경보</h3>
                                        <p class="settings-item-description">오늘 12시 대구지역 대설경보 발령. 야외 활동과 차량 운행을 자제하시고, 교통혼잡이 예상되니 출퇴근 시에는 대중교통을 이용해 주세요.</p>
                                    </div>
                                    <span class="settings-value text-nowrap p-1">활성화</span>
                                </li>
                            </ul>
                        </div>
                        <div class="card-footer">
                            <small>일일 발령 건수 : 20건</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-8 d-flex flex-column">
                    <div class="card d-flex h-100">
                        <div class="card-header py-2 px-3">
                            <h2 class="card-title">CCTV 모니터링</h2>
                            <a th:href="@{/main}" class="btn btn-primary btn-sm">전체보기</a>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- CCTV 1 -->
                                <div class="col-md-6 mb-3">
                                    <div class="cctv-feed position-relative">
                                        <img id="standbyImgEDS" src="/images/standbyImg.png" class="img-fluid w-100" alt="CCTV 1">
                                        <canvas id="videoCanvasEDS" class="img-fluid w-100 d-none"></canvas>
                                        <div class="position-absolute bottom-0 start-0 bg-dark bg-opacity-75 text-white p-2 w-100">
                                            <div class="d-flex justify-content-between">
                                                <span>주차장 입구</span>
                                                <span class="badge bg-success">활성</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        
                                <!-- CCTV 2 -->
                                <div class="col-md-6 mb-3">
                                    <div class="cctv-feed position-relative">
                                        <img id="standbyImgCam1" src="/images/standbyImg.png" class="img-fluid w-100" alt="CCTV 2">
                                        <canvas id="videoCanvasCam1" class="img-fluid w-100 d-none"></canvas>
                                        <div class="position-absolute bottom-0 start-0 bg-dark bg-opacity-75 text-white p-2 w-100">
                                            <div class="d-flex justify-content-between">
                                                <span>후문</span>
                                                <span class="badge bg-success">활성</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        
                                <!-- CCTV 3 -->
                                <div class="col-md-6 mb-3">
                                    <div class="cctv-feed position-relative">
                                        <img id="standbyImgCam2" src="/images/standbyImg.png" class="img-fluid w-100" alt="CCTV 3">
                                        <canvas id="videoCanvasCam2" class="img-fluid w-100 d-none"></canvas>
                                        <div class="position-absolute bottom-0 start-0 bg-dark bg-opacity-75 text-white p-2 w-100">
                                            <div class="d-flex justify-content-between">
                                                <span>정문</span>
                                                <span class="badge bg-success">활성</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        
                                <!-- CCTV 4 -->
                                <div class="col-md-6 mb-3">
                                    <div class="cctv-feed position-relative">
                                        <img id="standbyImgCam4" src="/images/standbyImg.png" class="img-fluid w-100" alt="CCTV 4">
                                        <canvas id="videoCanvasCam4" class="img-fluid w-100 d-none"></canvas>
                                        <div class="position-absolute bottom-0 start-0 bg-dark bg-opacity-75 text-white p-2 w-100">
                                            <div class="d-flex justify-content-between">
                                                <span>창고</span>
                                                <span class="badge bg-danger">비활성</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <div class="col-md-4 d-flex flex-column">
                    <div class="card d-flex h-100">
                        <div class="card-header py-2 px-3">
                        <h2 class="card-title">최근 발생 이력</h2>
                        <a href="#" class="btn btn-primary btn-sm">전체보기</a>
                        </div>
                        <div class="card-body">
                        <ul class="timeline">
                            <li class="timeline-item">
                                <div class="timeline-badge danger">
                                    <i class="bi bi-exclamation"></i>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-time">오늘 15:20</div>
                                    <h3 class="timeline-title">침입 감지 - 카메라2 1번 구역</h3>
                                    <p class="timeline-text">출입 감지, 알림 발송됨</p>
                                </div>
                            </li>
                            <li class="timeline-item">
                                <div class="timeline-badge danger">
                                    <i class="bi bi-exclamation"></i>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-time">오늘 14:50</div>
                                    <h3 class="timeline-title">침입 감지 - 카메라2 1번 구역</h3>
                                    <p class="timeline-text">출입 감지, 알림 발송됨</p>
                                </div>
                            </li>
                            <li class="timeline-item">
                                <div class="timeline-badge danger">
                                    <i class="bi bi-exclamation"></i>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-time">오늘 14:35</div>
                                    <h3 class="timeline-title">침입 감지 - 카메라2 3번 구역</h3>
                                    <p class="timeline-text">출입 감지, 알림 발송됨</p>
                                </div>
                            </li>
                            <li class="timeline-item">
                                <div class="timeline-badge warning">
                                    <i class="bi bi-bell"></i>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-time">오늘 12:22</div>
                                    <h3 class="timeline-title">특보 발령 - 전체 지역</h3>
                                    <p class="timeline-text">산불 대피 방송 완료</p>
                                </div>
                            </li>
                            <li class="timeline-item">
                                <div class="timeline-badge danger">
                                    <i class="bi bi-exclamation"></i>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-time">오늘 09:47</div>
                                    <h3 class="timeline-title">침입 감지 - 카메라1 2번 구역</h3>
                                    <p class="timeline-text">미등록 차량 출입 감지, 자동 알림 발송됨</p>
                                </div>
                            </li>
                            <li class="timeline-item">
                                <div class="timeline-badge success">
                                    <i class="bi bi-check"></i>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-time">어제 17:05</div>
                                    <h3 class="timeline-title">BGM 발령</h3>
                                    <p class="timeline-text">BGM 발령 완료, 이상 없음</p>
                                </div>
                            </li>
                            <li class="timeline-item">
                                <div class="timeline-badge danger">
                                    <i class="bi bi-exclamation"></i>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-time">어제 16:35</div>
                                    <h3 class="timeline-title">침입 감지 - 카메라3 4번 구역</h3>
                                    <p class="timeline-text">출입 감지, 알림 발송됨</p>
                                </div>
                            </li>
                            <!-- <li class="timeline-item">
                                <div class="timeline-badge warning">
                                    <i class="bi bi-bell"></i>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-time">어제 15:22</div>
                                    <h3 class="timeline-title">특보 발령 - 전체 지역</h3>
                                    <p class="timeline-text">폭우 대비 방송 완료</p>
                                </div>
                            </li> -->
                        </ul>
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- 대시보드 메인 콘텐츠 -->
            <div class="row">
                <!-- 좌측 영역 -->
                <div class="col-md-3 d-flex flex-column">
                    <div class="card d-flex h-100">
                        <div class="card-header py-2 px-3">
                            <h2 class="card-title">날씨</h2>
                        </div>
                        <div class="card-body d-flex">
                            <img src="/imgFiles/radar202505190925.png" class="img-fluid w-100" alt="지도">
                        </div>
                    </div>
                </div>

                <div class="col-md-4 d-flex flex-column">
                    <div class="card d-flex h-100">
                        <div class="card-header py-2 px-3">
                            <h2 class="card-title">BGM 스케줄</h2>
                            <a href="#" class="btn btn-primary btn-sm">스케줄 관리</a>
                        </div>
                        <div class="card-body">
                            <ul class="settings-list">
                                <li class="settings-item">
                                <div>
                                    <h3 class="settings-item-title">아침 BGM</h3>
                                    <p class="settings-item-description">08:00 ~ 09:00</p>
                                </div>
                                <span class="settings-value">클래식 모음</span>
                                </li>
                                <li class="settings-item">
                                <div>
                                    <h3 class="settings-item-title">점심 BGM</h3>
                                    <p class="settings-item-description">12:00 ~ 13:00</p>
                                </div>
                                <span class="settings-value">가요 모음</span>
                                </li>
                                <li class="settings-item">
                                <div>
                                    <h3 class="settings-item-title">저녁 BGM</h3>
                                    <p class="settings-item-description">17:00 ~ 18:00</p>
                                </div>
                                <span class="settings-value">재즈 모음</span>
                                </li>
                                <li class="settings-item">
                                <div>
                                    <h3 class="settings-item-title">다음 예약</h3>
                                </div>
                                <span class="settings-value">17:00 (2시간 후)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
        
                <!-- 중앙 영역 -->
                <div class="col-md-5 d-flex flex-column">
                    <div class="card d-flex h-100">
                        <div class="card-header py-2 px-3">
                            <h2 class="card-title">무선 스피커 상태</h2>
                            <a href="#" class="btn btn-primary btn-sm">스피커 관리</a>
                        </div>
                        <div class="card-body">
                            <ul class="speaker-list">
                                <li class="speaker-item">
                                <div class="speaker-icon">
                                    <i class="bi bi-speaker"></i>
                                </div>
                                <div class="speaker-info">
                                    <h3 class="speaker-name">스피커 #1</h3>
                                    <p class="speaker-location">사무실 앞</p>
                                </div>
                                <span class="speaker-status active">활성</span>
                                </li>
                                <li class="speaker-item">
                                <div class="speaker-icon">
                                    <i class="bi bi-speaker"></i>
                                </div>
                                <div class="speaker-info">
                                    <h3 class="speaker-name">스피커 #2</h3>
                                    <p class="speaker-location">포항시</p>
                                </div>
                                <span class="speaker-status active">활성</span>
                                </li>
                                <li class="speaker-item">
                                <div class="speaker-icon">
                                    <i class="bi bi-speaker"></i>
                                </div>
                                <div class="speaker-info">
                                    <h3 class="speaker-name">스피커 #3</h3>
                                    <p class="speaker-location">대구시</p>
                                </div>
                                <span class="speaker-status inactive">비활성</span>
                                </li>
                                <li class="speaker-item">
                                <div class="speaker-icon">
                                    <i class="bi bi-speaker"></i>
                                </div>
                                <div class="speaker-info">
                                    <h3 class="speaker-name">스피커 #4</h3>
                                    <p class="speaker-location">경산시</p>
                                </div>
                                <span class="speaker-status active">활성</span>
                                </li>
                            </ul>
                        </div>
                        <div class="card-footer">
                            <span>온라인: 3/4</span>
                            <a href="#" class="btn btn-success btn-sm">새 스피커 등록</a>
                        </div>
                    </div>
                </div>
        
            </div>
        
            <!-- 하단 영역 -->
            <div class="row">
                <!-- 우측 영역 -->
                <div class="col">
                    <!-- 시스템 상태 -->
                    <div class="card">
                        <div class="card-header py-2 px-3">
                            <h2 class="card-title">시스템 통계</h2>
                            <a href="#" class="btn btn-primary btn-sm">상세보기</a>
                        </div>
                        <div class="card-body">
                            <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem;">
                                <div style="flex: 1; min-width: 120px; text-align: center;">
                                <h3 class="settings-item-title pb-3">주간 출입 현황</h3>
                                <div class="circular-progress" style="position: relative; width: 100px; height: 100px; margin: 0 auto;">
                                    <svg width="100" height="100" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#e6e6e6" stroke-width="10" />
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#4e73df" stroke-width="10" 
                                        stroke-dasharray="283" stroke-dashoffset="85" transform="rotate(-90 50 50)" />
                                    </svg>
                                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.25rem; font-weight: bold;">
                                    70%
                                    </div>
                                </div>
                                <p style="margin-top: 0.5rem; font-size: 0.75rem; color: #858796;">전주 대비 +12%</p>
                                </div>
                                <div style="flex: 1; min-width: 120px; text-align: center;">
                                <h3 class="settings-item-title pb-3">스피커 방송 횟수</h3>
                                <div class="circular-progress" style="position: relative; width: 100px; height: 100px; margin: 0 auto;">
                                    <svg width="100" height="100" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#e6e6e6" stroke-width="10" />
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#1cc88a" stroke-width="10" 
                                        stroke-dasharray="283" stroke-dashoffset="113" transform="rotate(-90 50 50)" />
                                    </svg>
                                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.25rem; font-weight: bold;">
                                    60%
                                    </div>
                                </div>
                                <p style="margin-top: 0.5rem; font-size: 0.75rem; color: #858796;">전주 대비 -5%</p>
                                </div>
                                <div style="flex: 1; min-width: 120px; text-align: center;">
                                <h3 class="settings-item-title pb-3">특보 발령 횟수</h3>
                                <div class="circular-progress" style="position: relative; width: 100px; height: 100px; margin: 0 auto;">
                                    <svg width="100" height="100" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#e6e6e6" stroke-width="10" />
                                    <circle cx="50" cy="50" r="45" fill="none" stroke="#f6c23e" stroke-width="10" 
                                        stroke-dasharray="283" stroke-dashoffset="226" transform="rotate(-90 50 50)" />
                                    </svg>
                                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.25rem; font-weight: bold;">
                                    20%
                                    </div>
                                </div>
                                <p style="margin-top: 0.5rem; font-size: 0.75rem; color: #858796;">전주 대비 -15%</p>
                                </div>
                            </div>
                        
                            <!-- 주간 통계 그래프 -->
                            <div style="margin-top: 1.5rem;">
                                <h3 class="settings-item-title">주간 활동 추이</h3>
                                <div style="height: 200px; margin-top: 0.5rem;">
                                    <svg viewBox="0 0 500 200" width="100%" height="100%">
                                        <!-- 그리드 라인 -->
                                        <line x1="50" y1="20" x2="50" y2="170" stroke="#e6e6e6" stroke-width="1" />
                                        <line x1="50" y1="170" x2="480" y2="170" stroke="#e6e6e6" stroke-width="1" />
                                        <line x1="50" y1="20" x2="480" y2="20" stroke="#e6e6e6" stroke-width="1" stroke-dasharray="5,5" />
                                        <line x1="50" y1="70" x2="480" y2="70" stroke="#e6e6e6" stroke-width="1" stroke-dasharray="5,5" />
                                        <line x1="50" y1="120" x2="480" y2="120" stroke="#e6e6e6" stroke-width="1" stroke-dasharray="5,5" />
                                        
                                        <!-- X축 라벨 -->
                                        <text x="80" y="190" text-anchor="middle" font-size="12" fill="#858796">월</text>
                                        <text x="142" y="190" text-anchor="middle" font-size="12" fill="#858796">화</text>
                                        <text x="204" y="190" text-anchor="middle" font-size="12" fill="#858796">수</text>
                                        <text x="266" y="190" text-anchor="middle" font-size="12" fill="#858796">목</text>
                                        <text x="328" y="190" text-anchor="middle" font-size="12" fill="#858796">금</text>
                                        <text x="390" y="190" text-anchor="middle" font-size="12" fill="#858796">토</text>
                                        <text x="452" y="190" text-anchor="middle" font-size="12" fill="#858796">일</text>
                                        
                                        <!-- Y축 라벨 -->
                                        <text x="35" y="175" text-anchor="end" font-size="12" fill="#858796">0</text>
                                        <text x="35" y="125" text-anchor="end" font-size="12" fill="#858796">50</text>
                                        <text x="35" y="75" text-anchor="end" font-size="12" fill="#858796">100</text>
                                        <text x="35" y="25" text-anchor="end" font-size="12" fill="#858796">150</text>
                                        
                                        <!-- 출입 현황 선 그래프 -->
                                        <polyline 
                                        points="80,120 142,90 204,60 266,80 328,40 390,70 452,100" 
                                        fill="none" 
                                        stroke="#4e73df" 
                                        stroke-width="3"
                                        />
                                        <!-- 출입 현황 포인트 -->
                                        <circle cx="80" cy="120" r="4" fill="#4e73df" />
                                        <circle cx="142" cy="90" r="4" fill="#4e73df" />
                                        <circle cx="204" cy="60" r="4" fill="#4e73df" />
                                        <circle cx="266" cy="80" r="4" fill="#4e73df" />
                                        <circle cx="328" cy="40" r="4" fill="#4e73df" />
                                        <circle cx="390" cy="70" r="4" fill="#4e73df" />
                                        <circle cx="452" cy="100" r="4" fill="#4e73df" />
                                        
                                        <!-- 스피커 방송 선 그래프 -->
                                        <polyline 
                                        points="80,150 142,130 204,140 266,110 328,120 390,140 452,130" 
                                        fill="none" 
                                        stroke="#1cc88a" 
                                        stroke-width="3"
                                        stroke-dasharray="5,3"
                                        />
                                        <!-- 스피커 방송 포인트 -->
                                        <circle cx="80" cy="150" r="4" fill="#1cc88a" />
                                        <circle cx="142" cy="130" r="4" fill="#1cc88a" />
                                        <circle cx="204" cy="140" r="4" fill="#1cc88a" />
                                        <circle cx="266" cy="110" r="4" fill="#1cc88a" />
                                        <circle cx="328" cy="120" r="4" fill="#1cc88a" />
                                        <circle cx="390" cy="140" r="4" fill="#1cc88a" />
                                        <circle cx="452" cy="130" r="4" fill="#1cc88a" />
                                        
                                        <!-- 범례 -->
                                        <rect x="350" y="10" width="12" height="3" fill="#4e73df" />
                                        <text x="370" y="14" font-size="11" fill="#858796">출입 현황</text>
                                        <line x1="350" y1="25" x2="362" y2="25" stroke="#1cc88a" stroke-width="3" stroke-dasharray="5,3" />
                                        <text x="370" y="29" font-size="11" fill="#858796">스피커 방송</text>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <span>마지막 업데이트: 5분 전</span>
                            <a href="#" class="btn btn-success btn-sm">새로고침</a>
                        </div>
                    </div>
                </div>
                <!-- <div class="col">
                    <div class="card">
                        <div class="card-header py-2 px-3 bg-transparent border-0">
                            <h2 class="card-title">빠른 메뉴</h2>
                        </div>
                        <div class="card-body" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            <a href="#" class="btn btn-primary">상황발생이력</a>
                            <a href="#" class="btn btn-primary">발령이력</a>
                            <a href="#" class="btn btn-primary">특보이력</a>
                            <a href="#" class="btn btn-primary">문안설정</a>
                            <a href="#" class="btn btn-primary">사용자설정</a>
                            <a href="#" class="btn btn-success">CCTV 관리</a>
                            <a href="#" class="btn btn-success">스피커 관리</a>
                            <a href="#" class="btn btn-warning">환경설정</a>
                        </div>
                    </div>
                </div> -->
            </div>
        </div>
        <script>
            let currentAudio = null;
        
            document.getElementById('sendAlertBtn').addEventListener('click', function (e) {
                e.preventDefault(); // 기본 링크 동작 방지
        
                const sendType = document.querySelector('select[name="sendType"]').value;
        
                const wavFiles = {
                    wav1: '/audio/wav_1.mp3',
                    wav2: '/audio/wav_2.mp3',
                    wav3: '/audio/wav_3.mp3',
                    wav4: '/audio/wav_4.mp3'
                };
        
                // 재생 중이면 중복 방지
                if (currentAudio && !currentAudio.paused) {
                    alert("이미 경보가 재생 중입니다.");
                    return;
                }
        
                if (wavFiles[sendType]) {
                    currentAudio = new Audio(wavFiles[sendType]);
                    currentAudio.play().catch(err => {
                        console.error("오디오 재생 실패:", err);
                    });
        
                    // 재생이 끝나면 초기화
                    currentAudio.onended = function () {
                        currentAudio = null;
                    };
                } else {
                    alert('재생할 경보를 선택해주세요.');
                }
            });

            const cameras = [
                { name: 'EDS', wsPort: 10001, active: true },
                { name: 'Cam1', wsPort: 10000, active: true },
                { name: 'Cam2', wsPort: 9999, active: true },
            ];

            const socketConnections = [];

            function handleConnectionError(standbyImg, canvas) {
                canvas.classList.add('d-none');
                standbyImg.classList.remove('d-none');
            }

            function startStreaming() {
                cameras.forEach(camera => {
                    if (!camera.active) return;

                    const canvas = document.getElementById(`videoCanvas${camera.name}`);
                    const standbyImg = document.getElementById(`standbyImg${camera.name}`);

                    if (!canvas || !standbyImg) {
                        console.warn(`Element not found for ${camera.name}`);
                        return;
                    }

                    const wsUrl = `ws://localhost:${camera.wsPort}`;
                    console.log(`Connecting to ${wsUrl}`);

                    let socket = new WebSocket(wsUrl);
                    socketConnections.push(socket);

                    socket.onopen = () => {
                        console.log(`Connected to ${camera.name}`);
                        const player = new JSMpeg.Player(`ws://localhost:${camera.wsPort}`, {
                            canvas: canvas,
                            videoBufferSize: 512 * 1024,
                            audio: false,
                            autoplay: true
                        });
                        standbyImg.classList.add('d-none');
                        canvas.classList.remove('d-none');
                    };

                    socket.onerror = (error) => {
                        console.error(`WebSocket error on ${camera.name}:`, error);
                        handleConnectionError(standbyImg, canvas);
                    };

                    socket.onclose = () => {
                        console.warn(`WebSocket closed for ${camera.name}`);
                        handleConnectionError(standbyImg, canvas);
                    };
                });
            }

            document.addEventListener("DOMContentLoaded", startStreaming);
        </script>
        
    </div>
</body>
</html>